---
title: "Quartz4ã§Zennäº’æ›ã®ç”»åƒãƒ‘ã‚¹(/images)ã‚’ä½¿ãˆã‚‹ã‚ˆã†ã«ã™ã‚‹æ”¹é€ "
emoji: "ğŸ”§"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["Quartz4", "Static Site Generator", "Zenn", "TypeScript"]
published: true
---

## ã¯ã˜ã‚ã«

[Quartz4](https://quartz.jzhao.xyz/)ã¯ç´ æ™´ã‚‰ã—ã„é™çš„ã‚µã‚¤ãƒˆã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãƒ¼ã§ã™ãŒã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯`content`ãƒ•ã‚©ãƒ«ãƒ€å†…ã®ç”»åƒã®ã¿ã‚’å‡¦ç†ã—ã¾ã™ã€‚ä¸€æ–¹ã€[Zenn](https://zenn.dev/)ã§ã¯`/images`ãƒ•ã‚©ãƒ«ãƒ€ã«ç”»åƒã‚’é…ç½®ã™ã‚‹ã®ãŒæ¨™æº–çš„ã§ã™ã€‚

ä¸¡æ–¹ã®ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã§ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’ç®¡ç†ã™ã‚‹å ´åˆã€ç”»åƒãƒ‘ã‚¹ã®æ•´åˆæ€§ã‚’ä¿ã¤ã“ã¨ãŒé‡è¦ã«ãªã‚Šã¾ã™ã€‚ä»Šå›ã¯ã€Quartz4ã§Zennäº’æ›ã®ç”»åƒãƒ‘ã‚¹ï¼ˆ`/images/ç”»åƒå.png`ï¼‰ã‚’ä½¿ãˆã‚‹ã‚ˆã†ã«æ”¹é€ ã—ãŸè©±ã§ã™ã€‚

## å•é¡Œï¼šQuartz4ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ç”»åƒç®¡ç†

Quartz4ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šã§ã¯ã€ä»¥ä¸‹ã®ã‚ˆã†ãªåˆ¶é™ãŒã‚ã‚Šã¾ã™ï¼š

- ç”»åƒã¯`content`ãƒ•ã‚©ãƒ«ãƒ€å†…ã«é…ç½®ã™ã‚‹å¿…è¦ãŒã‚ã‚‹
- `![](images/sample.png)`ã®ã‚ˆã†ãªç›¸å¯¾ãƒ‘ã‚¹ã§ã®å‚ç…§ãŒå‰æ
- ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆã®`/images`ãƒ•ã‚©ãƒ«ãƒ€ã¯å‡¦ç†ã•ã‚Œãªã„

ã“ã‚Œã«ã‚ˆã‚Šã€Zennã§ä½¿ç”¨ã—ã¦ã„ã‚‹`![](/images/sample.png)`å½¢å¼ã®ç”»åƒå‚ç…§ãŒæ©Ÿèƒ½ã›ãšã€ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®ç§»æ¤æ™‚ã«å¤§é‡ã®ãƒ‘ã‚¹ä¿®æ­£ãŒå¿…è¦ã«ãªã£ã¦ã—ã¾ã„ã¾ã™ã€‚

## è§£æ±ºæ–¹æ³•ï¼šassets.tsãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®æ”¹é€ 

Quartz4ã®`quartz/plugins/emitters/assets.ts`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ”¹é€ ã—ã¦ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆã®`/images`ãƒ•ã‚©ãƒ«ãƒ€ã‹ã‚‰ã‚‚ç”»åƒã‚’èª­ã¿è¾¼ã‚ã‚‹ã‚ˆã†ã«ã—ã¾ã—ãŸã€‚

### ä¸»ãªå¤‰æ›´ç‚¹

#### 1. filesToCopyé–¢æ•°ã®æ‹¡å¼µ

```typescript
const filesToCopy = async (argv: Argv, cfg: QuartzConfig) => {
  // æ—¢å­˜ï¼šcontentãƒ•ã‚©ãƒ«ãƒ€ã®éMDãƒ•ã‚¡ã‚¤ãƒ«ã‚’å–å¾—
  const contentFiles = await glob("**", argv.directory, ["**/*.md", ...cfg.configuration.ignorePatterns])
  
  // æ–°è¦ï¼šrootã®imagesãƒ•ã‚©ãƒ«ãƒ€ã‹ã‚‰ã‚‚ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å–å¾—
  const rootImagesPath = path.resolve(path.dirname(argv.directory), "images")
  let imagesFiles: FilePath[] = []
  
  if (fs.existsSync(rootImagesPath)) {
    const imagesGlob = await glob("**", rootImagesPath as FilePath, cfg.configuration.ignorePatterns)
    // ãƒ‘ã‚¹åŒºåˆ‡ã‚Šæ–‡å­—ã‚’çµ±ä¸€ã—ã¦images/ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ã‚’ä»˜ä¸
    imagesFiles = imagesGlob.map(fp => path.posix.join("images", fp) as FilePath)
  }
  
  return [...contentFiles, ...imagesFiles]
}
```

#### 2. copyFileé–¢æ•°ã®æ”¹è‰¯

```typescript
const copyFile = async (argv: Argv, fp: FilePath) => {
  let src: FilePath
  
  // Windows/Linuxå¯¾å¿œï¼šãƒ‘ã‚¹åŒºåˆ‡ã‚Šæ–‡å­—ã‚’æ­£è¦åŒ–
  const normalizedFp = fp.replace(/\\/g, '/')
  
  // images/ã§å§‹ã¾ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã¯rootãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‹ã‚‰å–å¾—
  if (normalizedFp.startsWith("images/")) {
    const rootDir = path.dirname(argv.directory)
    src = joinSegments(rootDir, fp) as FilePath
  } else {
    // å¾“æ¥é€šã‚Šcontentãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‹ã‚‰å–å¾—
    src = joinSegments(argv.directory, fp) as FilePath
  }

  const name = slugifyFilePath(fp)
  const dest = joinSegments(argv.output, name) as FilePath

  // ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä½œæˆã¨ãƒ•ã‚¡ã‚¤ãƒ«ã‚³ãƒ”ãƒ¼
  const dir = path.dirname(dest) as FilePath
  await fs.promises.mkdir(dir, { recursive: true })
  await fs.promises.copyFile(src, dest)
  return dest
}
```

#### 3. partialEmité–¢æ•°ã§ã®ãƒ›ãƒƒãƒˆãƒªãƒ­ãƒ¼ãƒ‰å¯¾å¿œ

```typescript
async *partialEmit(ctx, _content, _resources, changeEvents) {
  for (const changeEvent of changeEvents) {
    const ext = path.extname(changeEvent.path)
    if (ext === ".md") continue

    // rootã®imagesãƒ•ã‚©ãƒ«ãƒ€ã®å¤‰æ›´ã‚’æ¤œå‡º
    const rootImagesPath = path.resolve(path.dirname(ctx.argv.directory), "images")
    const isRootImageFile = changeEvent.path.startsWith(rootImagesPath)
    
    if (changeEvent.type === "add" || changeEvent.type === "change") {
      if (isRootImageFile) {
        // çµ¶å¯¾ãƒ‘ã‚¹ã‚’ç›¸å¯¾ãƒ‘ã‚¹ã«å¤‰æ›
        const relativePath = path.relative(path.dirname(ctx.argv.directory), changeEvent.path) as FilePath
        yield copyFile(ctx.argv, relativePath)
      } else {
        yield copyFile(ctx.argv, changeEvent.path)
      }
    } else if (changeEvent.type === "delete") {
      // å‰Šé™¤å‡¦ç†ã‚‚åŒæ§˜ã«å¯¾å¿œ
      let filePath: FilePath
      if (isRootImageFile) {
        filePath = path.relative(path.dirname(ctx.argv.directory), changeEvent.path) as FilePath
      } else {
        filePath = changeEvent.path
      }
      
      const name = slugifyFilePath(filePath)
      const dest = joinSegments(ctx.argv.output, name) as FilePath
      await fs.promises.unlink(dest)
    }
  }
}
```

## æŠ€è¡“çš„ãªãƒã‚¤ãƒ³ãƒˆ

### Windows/Linuxå¯¾å¿œ
ãƒ‘ã‚¹åŒºåˆ‡ã‚Šæ–‡å­—ã®é•ã„ï¼ˆWindows: `\`, Linux: `/`ï¼‰ã«å¯¾å¿œã™ã‚‹ãŸã‚ã€`path.posix.join()`ã¨æ­£è¦åŒ–å‡¦ç†ã‚’ä½¿ç”¨ã—ã¾ã—ãŸã€‚

### ãƒ›ãƒƒãƒˆãƒªãƒ­ãƒ¼ãƒ‰å¯¾å¿œ
é–‹ç™ºæ™‚ã®`npx quartz sync`ã§ã‚‚ã€rootã®`/images`ãƒ•ã‚©ãƒ«ãƒ€ã®å¤‰æ›´ã‚’å³åº§ã«åæ˜ ã§ãã‚‹ã‚ˆã†ã«`partialEmit`é–¢æ•°ã‚‚å¯¾å¿œã—ã¾ã—ãŸã€‚

### æ—¢å­˜æ©Ÿèƒ½ã®ä¿æŒ
å¾“æ¥ã®`content`ãƒ•ã‚©ãƒ«ãƒ€å†…ã®ç”»åƒå‡¦ç†ã¯ç¶­æŒã—ã¤ã¤ã€æ–°æ©Ÿèƒ½ã‚’è¿½åŠ ã™ã‚‹å½¢ã§å®Ÿè£…ã—ã¾ã—ãŸã€‚

## çµæœ

æ”¹é€ å¾Œã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸï¼š

- âœ… `/images/sample.png`å½¢å¼ã§Zennäº’æ›ã®ç”»åƒå‚ç…§ãŒå¯èƒ½
- âœ… `content/images/sample.png`å½¢å¼ã®å¾“æ¥ã®æ–¹æ³•ã‚‚ç¶™ç¶šåˆ©ç”¨å¯èƒ½
- âœ… ãƒ›ãƒƒãƒˆãƒªãƒ­ãƒ¼ãƒ‰ï¼ˆ`npx quartz sync`ï¼‰ã§ã‚‚æ­£å¸¸å‹•ä½œ
- âœ… Windows/Linuxä¸¡ç’°å¢ƒã§å‹•ä½œç¢ºèªæ¸ˆã¿

## ã¾ã¨ã‚

ã“ã®æ”¹é€ ã«ã‚ˆã‚Šã€Quartz4ã§Zennã¨åŒã˜ç”»åƒãƒ‘ã‚¹æ§‹é€ ã‚’ä½¿ç”¨ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚ã“ã‚Œã§ï¼š

1. **ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®ç§»æ¤ãŒç°¡å˜**: Zennã®è¨˜äº‹ã‚’ãã®ã¾ã¾Quartz4ã§ä½¿ç”¨å¯èƒ½
2. **ç®¡ç†ã®ä¸€å…ƒåŒ–**: ç”»åƒã‚’ä¸€ç®‡æ‰€ï¼ˆ`/images`ï¼‰ã§ç®¡ç†
3. **é–‹ç™ºåŠ¹ç‡å‘ä¸Š**: ãƒ‘ã‚¹ä¿®æ­£ã®æ‰‹é–“ãŒä¸è¦

åŒæ§˜ã®èª²é¡Œã‚’æŠ±ãˆã¦ã„ã‚‹æ–¹ã®å‚è€ƒã«ãªã‚Œã°å¹¸ã„ã§ã™ã€‚

## å‚è€ƒãƒªãƒ³ã‚¯

- [Quartz4å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://quartz.jzhao.xyz/)
- [Zennç”»åƒã®è²¼ã‚Šæ–¹](https://zenn.dev/zenn/articles/deploy-github-images)
