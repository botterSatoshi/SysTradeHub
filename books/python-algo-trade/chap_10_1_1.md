---
title: 資産管理
free: true
---
全資産のうち何割の資産をトレードに投じるか。この答えは達成しようとしている主目的と言っていい。ほとんどの人にとって、**長期的な資産の最大化**が目的でしょう。
これこそ、Edward Thorpが論文「Rotand and Thorp 1992」で、投資における**ケリー基準**を論じたときに考えていたことです。簡単に言えば、ケリー基準とは、統計的なリターンの特性を考慮して、ある戦略にトレーダーが投入すべき利用可能な資産の割合を明示的に計算することができるものです。

## 10.1.1 二項設定でのケリー基準

ケリー基準を投資に導入するには、コイントスより一般的には（2つの結果しか起こりえない）二項設定をベースにした方法を使うのが一般的です。本節では、その道筋に沿って説明します。

ギャンブラーが、無限にお金を持っている銀行やカジノを相手にコイントスをすると仮定します。さらに、表の出る確率が、以下を満たす $p$ であると仮定します。

$$
\frac{1}{2} < p <1
$$

裏の出る確率は次のように定義されます。
$$
q = 1 - p < \frac{1}{2}
$$
ギャンブラーは、任意の大きさ $b > 0$ を賭けることができ、正しければ同額を勝ち取り、間違っていればすべてを失います。確率の仮定を考えると、ギャンブラーはもちろん表が出る方に賭けたいを思うでしょう。
したがって、この賭け$B$（賭けを表す確率変数）の1回の試行に対する期待値は次のようになります。

$$
E(B) = p \cdot b - q \cdot b = (p - q) \cdot b > 0
$$

資金が無限にあるリスク中立なギャンブラーは、期待ペイオフを最大化するために、できるだけ大きな金額を賭けたいと考えるでしょう。しかし、金融マーケットでの取引は、一般的に一発勝負ではありません。試行を繰り返すゲームなのです。そこで、$b_i$ をその日に賭ける金額、$c_0$ を初期資金とすると1日目終了時の資本 $c_1$ は、その日の賭けの成功に依存し、$c_0 + b_1$ または $c_0 - b_1$ のいずれかとなります。このとき $n$回繰り返されるギャンブルの期待値は次のようになります。
$$
E(B^n) = c_0 + \sum_{i=1}^n (p-q) \cdot b_i
$$

古典派経済学の理論では、リスク中立で期待効用を最大化するシュミレーションであれば、ギャンブラーは前記の式を最大化しようとします。一発勝負のように、利用可能な資金 $b_i=c_{i-1}$をすべて賭けることで最大化できることが容易に近いできます。
しかし、これでは1回の損失ですべての資金が消えてしまい、（無制限の借り入れができない限り）破産してしまうことになります。
したがって、この戦略は長期的な資産の最大化にはつながりません。

利用可能な最大の資産を賭けると突然の破産につながるかもしれませんが、何も賭けないでいると、あらゆる損失を避けることができますが、有利なギャンブルの恩恵も受けられません。
ここで、ケリー基準が登場します。ケリー基準は、1回の賭けで賭けることができる利用可能な資産の **最適な割合 $f^*$** を導き出すものです。
$$
n=h+t
$$
ここで、 $h$ は $n$回の賭けで表の出る回数を表し、$t$ は裏の出る回数を表すとする。
これらの定義から、 $n$回の賭け後の利用可能な資産は次のようになります。

$$
c_n = c_0 \cdot (1+f)^h \cdot (1-f)^t
$$
ここで、長期的な資産を最大化することは、次で求められる賭け1回あたりの成長率の幾何平均を最大することに帰着します。

$$
\begin{equation} 
\begin{split}

r^g &= \log \bigg( \frac{c_n}{c_0} \bigg)^{1/n} \\
&= \log \bigg( \frac{c_0 \cdot (1+f)^h \cdot (1-f)^t}{c_0} \bigg)^{1/n} \\
&= \log((1+f)^h \cdot (1-f)^t)^{1/n} \\
&= \frac{h}{n} \log(1+f) + \frac{t}{n} \log(1-f)

\end{split} 
\end{equation}
$$

この問題は、**期待**平均成長率を最大化する最適な$f$を選択する問題に定式化されます。
$$
\begin{equation} 
\begin{split}

E(h) = n \cdot p \\
E(t) = n \cdot q 

\end{split} 
\end{equation}
$$
なので、次が成り立ちます。
$$
\begin{equation} 
\begin{split}

E(r^g) &= E \Big(\frac{h}{n} \log(1+f) + \frac{t}{n} \log(1-f) \Big) \\
&= E(p \cdot \log(1+f) + q \cdot \log(1-f)) \\
&= p \cdot \log(1+f) + q \cdot \log(1-f) \\
&\equiv G(f)

\end{split} 
\end{equation}
$$
1階条件に従って最適配分$f^*$ を選択すると、この項を最大化できます。 1階微分は次のようになります。

$$
\begin{equation} 
\begin{split}

G'(f) &= \frac{p}{1+f} - \frac{q}{1-f} \\
&= \frac{p-pf-q-qf}{(1+f)(1-f)} \\
&= \frac{p-q-f}{(1+f)(1-f)} \\

\end{split} 
\end{equation}
$$
1階条件から次を得られます。

$$
G'(f) \overset{!}{=} 0 \Rightarrow f^* = p - q
$$ 
これが、最小ではなく最大であると信じてもらうとして、この結果は賭け1回あたり$f^*=p-q$ で投資配分するのが最適であることを意味しています。
例えば$p=0.55$ なら $f^*=0.55-0.45=0.1$ で、最適配分は 10% です


$f$ の値を変えてシュミレーションを繰り返すと下図に示すように、配分が低いと平均的な成長率（振り幅）が低くなります。高い値を設定すると、シュミレーション終了時の平均資産が高くなる($f=0.25$)の場合と平均資産が大幅に低くなる($f=0.5$)の場合の両方が考えられます。いずれの場合も、配分$f$ が大きいほど、ボラティリティが大きくなります。
![[images/output.png]]


#
---
## sample code
>![[books/pythonからはじめるアルゴリズムトレード/src/ch10/10_pyalgo.ipynb]]